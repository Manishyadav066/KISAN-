{% extends 'kisan_app/base.html' %}

{% block title %}Analytics Dashboard - Kisan Project{% endblock %}

{% block content %}
<h2 style="color: #667eea; margin-bottom: 30px; font-size: 2.5em; text-align: center;">ğŸ“Š Analytics Dashboard</h2>

<!-- Key Metrics Cards -->
<div class="stats-grid" style="margin-bottom: 40px;">
    <div class="stat-card" style="background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);">
        <h3>ğŸ‘¨â€ğŸŒ¾ Total Farmers</h3>
        <div class="number">{{ total_farmers }}</div>
        <p>Active Farmers</p>
    </div>

    <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
        <h3>ğŸŒ¾ Total Crops</h3>
        <div class="number">{{ total_crops }}</div>
        <p>Registered Crops</p>
    </div>

    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <h3>ğŸ’° Total Revenue</h3>
        <div class="number">â‚¹{{ total_revenue|floatformat:0 }}</div>
        <p>Expected Revenue</p>
    </div>

    <div class="stat-card" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #333;">
        <h3>ğŸ“ˆ Total Profit</h3>
        <div class="number">â‚¹{{ total_profit|floatformat:0 }}</div>
        <p>Net Profit</p>
    </div>
</div>

<!-- Charts and Analytics -->
<div
    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px; margin-bottom: 40px;">

    <!-- Crop Distribution Chart -->
    <div class="card">
        <h3 style="color: #2c5530; margin-bottom: 20px;">ğŸŒ± Crop Distribution by Season</h3>
        <div style="height: 200px; display: flex; align-items: center; justify-content: center;">
            {% for item in crop_distribution %}
            <div style="margin: 10px; text-align: center;">
                <div
                    style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                    <strong>{{ item.season }}</strong><br>
                    {{ item.count }} crops<br>
                    â‚¹{{ item.total_value|floatformat:0 }}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Top Performing Crops -->
    <div class="card">
        <h3 style="color: #2c5530; margin-bottom: 20px;">ğŸ† Top Performing Crops</h3>
        {% for crop in top_crops %}
        <div
            style="display: flex; justify-content: space-between; align-items: center; padding: 10px; margin-bottom: 10px; background: #f8f9fa; border-radius: 8px;">
            <div>
                <strong>{{ crop.name }}</strong><br>
                <small>{{ crop.farmer.name }} - {{ crop.season }}</small>
            </div>
            <div style="text-align: right;">
                <strong style="color: #2c5530;">{{ crop.quantity }} kg</strong><br>
                <small>â‚¹{{ crop.total_value|floatformat:0 }}</small>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Upcoming Activities -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px;">

    <!-- Upcoming Harvests -->
    <div class="card">
        <h3 style="color: #f093fb; margin-bottom: 20px;">â° Upcoming Harvests (Next 30 Days)</h3>
        {% if upcoming_harvests %}
        {% for crop in upcoming_harvests %}
        <div
            style="display: flex; justify-content: space-between; align-items: center; padding: 12px; margin-bottom: 10px; border-left: 4px solid #f093fb; background: #fff5f5; border-radius: 0 8px 8px 0;">
            <div>
                <strong>{{ crop.name }}</strong><br>
                <small>{{ crop.farmer.name }}</small>
            </div>
            <div style="text-align: right;">
                <strong style="color: #f093fb;">{{ crop.harvest_date|date:"M d" }}</strong><br>
                <small>{{ crop.days_to_harvest }} days left</small>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <p style="text-align: center; color: #666; padding: 20px;">No upcoming harvests in the next 30 days</p>
        {% endif %}
    </div>

    <!-- Overdue Crops -->
    <div class="card">
        <h3 style="color: #dc3545; margin-bottom: 20px;">âš ï¸ Overdue Crops</h3>
        {% if overdue_crops %}
        {% for crop in overdue_crops %}
        <div
            style="display: flex; justify-content: space-between; align-items: center; padding: 12px; margin-bottom: 10px; border-left: 4px solid #dc3545; background: #fff5f5; border-radius: 0 8px 8px 0;">
            <div>
                <strong>{{ crop.name }}</strong><br>
                <small>{{ crop.farmer.name }} - {{ crop.status }}</small>
            </div>
            <div style="text-align: right;">
                <strong style="color: #dc3545;">{{ crop.harvest_date|date:"M d, Y" }}</strong><br>
                <small>{{ crop.days_to_harvest|add:"0" }} days overdue</small>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <p style="text-align: center; color: #666; padding: 20px;">âœ… No overdue crops - Great job!</p>
        {% endif %}
    </div>
</div>

<!-- Financial Summary -->
<div class="card" style="margin-top: 30px;">
    <h3 style="color: #2c5530; margin-bottom: 20px; text-align: center;">ğŸ’¼ Financial Overview</h3>
    <div
        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; text-align: center;">
        <div style="padding: 20px; background: linear-gradient(135deg, #e8f5e8, #c8e6c9); border-radius: 10px;">
            <h4 style="color: #2c5530; margin-bottom: 10px;">ğŸ’µ Total Investment</h4>
            <p style="font-size: 1.5em; font-weight: bold; color: #2c5530;">â‚¹{{ total_investment|floatformat:0 }}</p>
        </div>
        <div style="padding: 20px; background: linear-gradient(135deg, #e3f2fd, #bbdefb); border-radius: 10px;">
            <h4 style="color: #1976d2; margin-bottom: 10px;">ğŸ’° Expected Revenue</h4>
            <p style="font-size: 1.5em; font-weight: bold; color: #1976d2;">â‚¹{{ total_revenue|floatformat:0 }}</p>
        </div>
        <div style="padding: 20px; background: linear-gradient(135deg, #fff3e0, #ffcc02); border-radius: 10px;">
            <h4 style="color: #f57c00; margin-bottom: 10px;">ğŸ“Š Profit Margin</h4>
            <p style="font-size: 1.5em; font-weight: bold; color: #f57c00;">
                {% if total_investment > 0 %}
                {{ total_profit|floatformat:0 }}â‚¹ ({{ total_profit|add:total_investment|floatformat:1 }}%)
                {% else %}
                N/A
                {% endif %}
            </p>
        </div>
    </div>
</div>

<script>
    // Add some interactive features
    document.addEventListener('DOMContentLoaded', function () {
        // Animate numbers on scroll
        const numbers = document.querySelectorAll('.number');
        numbers.forEach(num => {
            num.style.opacity = '0';
            num.style.transform = 'translateY(20px)';
            setTimeout(() => {
                num.style.transition = 'all 0.6s ease';
                num.style.opacity = '1';
                num.style.transform = 'translateY(0)';
            }, Math.random() * 500);
        });

        // Add hover effects to cards
        const cards = document.querySelectorAll('.card');
        cards.forEach(card => {
            card.addEventListener('mouseenter', function () {
                this.style.transform = 'translateY(-5px) scale(1.02)';
            });
            card.addEventListener('mouseleave', function () {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });
    });
</script>
{% endblock %}